; NOTE: Assertions have been autogenerated by utils/update_test_checks.py
; RUN: opt -S -linearize-cfg %s | FileCheck %s

define void @figure6c(i1 %cond0, i1 %cond1, i1 %cond2) {
; CHECK-LABEL: @figure6c(
; CHECK-NEXT:  dummy.idom:
; CHECK-NEXT:    br label [[B1_GUARD:%.*]]
; CHECK:       b1.guard:
; CHECK-NEXT:    br label [[B1:%.*]]
; CHECK:       b1:
; CHECK-NEXT:    store volatile i32 1, i32 addrspace(1)* undef
; CHECK-NEXT:    [[TMP0:%.*]] = select i1 [[COND0:%.*]], i32 1, i32 2
; CHECK-NEXT:    br label [[B2_GUARD:%.*]]
; CHECK:       b2.guard:
; CHECK-NEXT:    [[GUARD_VAR:%.*]] = phi i32 [ [[TMP0]], [[B1]] ], [ 2, [[B3_SPLIT:%.*]] ]
; CHECK-NEXT:    [[PREV_GUARD:%.*]] = icmp eq i32 [[GUARD_VAR]], 1
; CHECK-NEXT:    br i1 [[PREV_GUARD]], label [[B2:%.*]], label [[B3_GUARD:%.*]]
; CHECK:       b2:
; CHECK-NEXT:    store volatile i32 2, i32 addrspace(1)* undef
; CHECK-NEXT:    br label [[B3_GUARD]]
; CHECK:       b3.guard:
; CHECK-NEXT:    [[GUARD_VAR1:%.*]] = phi i32 [ [[GUARD_VAR]], [[B2_GUARD]] ], [ 2, [[B2]] ]
; CHECK-NEXT:    [[LAST:%.*]] = icmp eq i32 [[GUARD_VAR1]], 2
; CHECK-NEXT:    br i1 [[LAST]], label [[B3:%.*]], label [[B3_SPLIT]]
; CHECK:       b3:
; CHECK-NEXT:    store volatile i32 3, i32 addrspace(1)* undef
; CHECK-NEXT:    br label [[B3_SPLIT]]
; CHECK:       b3.split:
; CHECK-NEXT:    br label [[B2_GUARD]]
;
b1:
  store volatile i32 1, i32 addrspace(1)* undef
  br i1 %cond0, label %b2, label %b3

b2:
  store volatile i32 2, i32 addrspace(1)* undef
  br label %b3

b3:
  store volatile i32 3, i32 addrspace(1)* undef
  br label %b2
}
